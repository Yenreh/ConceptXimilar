<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demostraci√≥n Ximilar API - Plan Gratuito</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Demostraci√≥n Ximilar API</h1>
            <p>Servicios disponibles en el plan gratuito</p>
        </div>

        <div class="main-card">
            <div class="tab-bar">
                <button class="tab-btn active" onclick="showTab('removebg')">Background Removal</button>
                <button class="tab-btn" onclick="showTab('colors')">Dominant Colors</button>
            </div>

            <!-- BACKGROUND REMOVAL TAB -->
            <div id="tab-removebg" class="tab-content" style="display:block;">
                <div class="removebg-section">
                    <h2 class="section-title">Eliminaci√≥n de Fondo</h2>
                    
                    <div class="controls">
                        <input type="text" id="removebgUrl" placeholder="URL de imagen" class="styled-input wide-input">
                        <button class="btn btn-start" onclick="removeBgUrl()">üóëÔ∏è Eliminar Fondo (URL)</button>
                    </div>
                    
                    <div class="controls">
                        <input type="file" id="removebgFile" accept="image/*" class="styled-input">
                        <button class="btn btn-start" onclick="removeBgFile()">üìÅ Eliminar Fondo (Archivo)</button>
                    </div>
                    
                    <div class="controls">
                        <select id="removebgModel" class="styled-input">
                            <option value="precise">Modelo Preciso (alta calidad)</option>
                            <option value="fast">Modelo R√°pido (menor costo)</option>
                        </select>
                    </div>
                    
                    <div id="removebgLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Procesando imagen...</p>
                    </div>
                    
                    <div id="removebgResult" class="result-images"></div>
                </div>
            </div>

            <!-- DOMINANT COLORS TAB -->
            <div id="tab-colors" class="tab-content" style="display:none;">
                <div class="colors-section">
                    <h2 class="section-title">Colores Dominantes</h2>
                    
                    <div class="controls">
                        <input type="text" id="colorsUrl" placeholder="URL de imagen" class="styled-input wide-input">
                        <button class="btn btn-start" onclick="analyzeColorsUrl()">üé® Extraer Colores (URL)</button>
                    </div>
                    
                    <div class="controls">
                        <input type="file" id="colorsFile" accept="image/*" class="styled-input">
                        <button class="btn btn-start" onclick="analyzeColorsFile()">üìÅ Extraer Colores (Archivo)</button>
                    </div>
                    
                    <div class="controls">
                        <label style="color: #9ca3af;">N√∫mero m√°ximo de colores:</label>
                        <input type="number" id="maxColors" value="5" min="1" max="10" class="styled-input" style="width: 80px;">
                    </div>
                    
                    <div id="colorsLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Extrayendo colores...</p>
                    </div>
                    
                    <div id="colorsResult" class="color-palette"></div>
                    <div id="colorsImage" class="image-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tabDiv => tabDiv.style.display = 'none');
            document.querySelector('.tab-btn[onclick*="' + tab + '"]').classList.add('active');
            document.getElementById('tab-' + tab).style.display = 'block';
        }

        // Background Removal Functions
        async function removeBgUrl() {
            const url = document.getElementById('removebgUrl').value;
            if (!url) {
                alert('Por favor ingrese una URL de imagen');
                return;
            }
            
            const model = document.getElementById('removebgModel').value;
            
            document.getElementById('removebgLoading').style.display = 'block';
            document.getElementById('removebgResult').innerHTML = '';
            
            const response = await fetch('/removebg', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url, model })
            });
            
            document.getElementById('removebgLoading').style.display = 'none';
            const data = await response.json();
            displayRemoveBgResults(data);
        }

        async function removeBgFile() {
            const fileInput = document.getElementById('removebgFile');
            if (!fileInput.files.length) {
                alert('Por favor seleccione un archivo de imagen');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('model', document.getElementById('removebgModel').value);
            
            document.getElementById('removebgLoading').style.display = 'block';
            document.getElementById('removebgResult').innerHTML = '';
            
            const response = await fetch('/removebg/upload', {
                method: 'POST',
                body: formData
            });
            
            document.getElementById('removebgLoading').style.display = 'none';
            const data = await response.json();
            displayRemoveBgResults(data);
        }

        function displayRemoveBgResults(data) {
            const resultDiv = document.getElementById('removebgResult');
            
            if (data.error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.error}</div>`;
                return;
            }
            
            if (!data.records || !data.records.length) {
                resultDiv.innerHTML = '<div class="error">No se encontraron resultados</div>';
                return;
            }
            
            const record = data.records[0];
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">';
            
            if (record._output_url) {
                html += `
                    <div style="background: rgba(31, 41, 55, 0.5); padding: 15px; border-radius: 10px;">
                        <h4 style="color: #a5b4fc; margin-bottom: 10px;">üñºÔ∏è Fondo Transparente</h4>
                        <img src="${record._output_url}" style="width: 100%; border-radius: 8px; background: repeating-conic-gradient(#808080 0% 25%, transparent 0% 50%) 50% / 20px 20px;">
                        <a href="${record._output_url}" download class="btn btn-start" style="margin-top: 10px; justify-content: center;">‚¨áÔ∏è Descargar</a>
                    </div>
                `;
            }
            
            html += '</div>';
            
            if (data.statistics && data.statistics['processing time']) {
                html += `<p style="color: #9ca3af; margin-top: 15px; text-align: center; font-size: 0.9em;">‚è±Ô∏è Tiempo de procesamiento: ${data.statistics['processing time'].toFixed(2)}s</p>`;
            }
            
            resultDiv.innerHTML = html;
        }

        // Dominant Colors Functions
        async function analyzeColorsUrl() {
            const url = document.getElementById('colorsUrl').value;
            if (!url) {
                alert('Por favor ingrese una URL de imagen');
                return;
            }
            
            const maxColors = parseInt(document.getElementById('maxColors').value);
            
            document.getElementById('colorsLoading').style.display = 'block';
            document.getElementById('colorsResult').innerHTML = '';
            document.getElementById('colorsImage').innerHTML = '';
            
            const response = await fetch('/colors/dominant', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url, max_colors: maxColors })
            });
            
            document.getElementById('colorsLoading').style.display = 'none';
            const data = await response.json();
            displayColorsResults(data, url);
        }

        async function analyzeColorsFile() {
            const fileInput = document.getElementById('colorsFile');
            if (!fileInput.files.length) {
                alert('Por favor seleccione un archivo de imagen');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('max_colors', document.getElementById('maxColors').value);
            
            document.getElementById('colorsLoading').style.display = 'block';
            document.getElementById('colorsResult').innerHTML = '';
            document.getElementById('colorsImage').innerHTML = '';
            
            const response = await fetch('/colors/upload', {
                method: 'POST',
                body: formData
            });
            
            document.getElementById('colorsLoading').style.display = 'none';
            const data = await response.json();
            displayColorsResults(data);
        }

        function displayColorsResults(data, imageUrl) {
            const resultDiv = document.getElementById('colorsResult');
            const imageDiv = document.getElementById('colorsImage');
            
            if (data.error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.error}</div>`;
                return;
            }
            
            if (!data.records || !data.records.length) {
                resultDiv.innerHTML = '<div class="error">No se encontraron resultados</div>';
                return;
            }
            
            const record = data.records[0];
            
            if (imageUrl) {
                imageDiv.innerHTML = `<img src="${imageUrl}" style="max-width: 100%; border-radius: 10px; margin-bottom: 20px;">`;
            }
            
            let html = '<div style="margin-top: 20px;">';
            
            if (record._dominant_colors && record._dominant_colors.length > 0) {
                html += '<h3 style="color: #a5b4fc; margin-bottom: 15px;">üé® Colores Dominantes:</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">';
                
                record._dominant_colors.forEach(color => {
                    const rgb = `rgb(${color.r}, ${color.g}, ${color.b})`;
                    html += `
                        <div style="background: rgba(31, 41, 55, 0.5); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="width: 100%; height: 80px; background: ${rgb}; border-radius: 8px; margin-bottom: 10px; border: 2px solid rgba(255,255,255,0.1);"></div>
                            <p style="color: #e5e7eb; font-weight: 600; margin-bottom: 5px;">${color.name || 'Color'}</p>
                            <p style="color: #9ca3af; font-size: 0.85em;">RGB(${color.r}, ${color.g}, ${color.b})</p>
                            <p style="color: #9ca3af; font-size: 0.85em;">${(color.coverage * 100).toFixed(1)}% cobertura</p>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>

            <!-- FASHION TAGGING TAB -->
            <div id="tab-fashion" class="tab-content" style="display:block;">
                <div class="fashion-section">
                    <h2 class="section-title">Detecci√≥n y Etiquetado de Moda</h2>
                    
                    <div class="error" style="display:block;">
                        ‚ö†Ô∏è <strong>Fashion Tagging no est√° disponible en el plan gratuito.</strong><br>
                        Servicios disponibles en el plan free: Background Removal, Dominant Colors, Custom Image Recognition, Object Detection.<br>
                        <a href="https://ximilar.com/pricing" target="_blank" style="color: #a5b4fc;">Ver planes</a>
                    </div>
                    
                    <div class="controls">
                        <input type="text" id="fashionUrl" placeholder="URL de imagen" class="styled-input wide-input" disabled>
                        <button class="btn btn-start" onclick="analyzeFashionUrl()" disabled style="opacity: 0.5;">ÔøΩ Analizar URL (No disponible)</button>
                    </div>
                    
                    <div class="controls">
                        <input type="file" id="fashionFile" accept="image/*" class="styled-input" disabled>
                        <button class="btn btn-start" onclick="analyzeFashionFile()" disabled style="opacity: 0.5;">üìÅ Analizar Archivo (No disponible)</button>
                    </div>
                    
                    <div id="fashionLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Analizando imagen...</p>
                    </div>
                    
                    <div id="fashionResult" class="result-box"></div>
                    <div id="fashionImage" class="image-preview"></div>
                </div>
            </div>

            <!-- BACKGROUND REMOVAL TAB -->
            <div id="tab-removebg" class="tab-content" style="display:none;">
                <div class="removebg-section">
                    <h2 class="section-title">Eliminaci√≥n de Fondo</h2>
                    
                    <div class="controls">
                        <input type="text" id="removebgUrl" placeholder="URL de imagen" class="styled-input wide-input">
                        <button class="btn btn-start" onclick="removeBgUrl()">üóëÔ∏è Eliminar Fondo (URL)</button>
                    </div>
                    
                    <div class="controls">
                        <input type="file" id="removebgFile" accept="image/*" class="styled-input">
                        <button class="btn btn-start" onclick="removeBgFile()">üìÅ Eliminar Fondo (Archivo)</button>
                    </div>
                    
                    <div class="controls">
                        <select id="removebgModel" class="styled-input">
                            <option value="precise">Modelo Preciso (alta calidad)</option>
                            <option value="fast">Modelo R√°pido (menor costo)</option>
                        </select>
                        <label style="color: #9ca3af; display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="whiteBg" checked>
                            Incluir fondo blanco
                        </label>
                        <label style="color: #9ca3af; display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="binaryMask">
                            Incluir m√°scara binaria
                        </label>
                    </div>
                    
                    <div id="removebgLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Procesando imagen...</p>
                    </div>
                    
                    <div id="removebgResult" class="result-images"></div>
                </div>
            </div>

            <!-- DOMINANT COLORS TAB -->
            <div id="tab-colors" class="tab-content" style="display:none;">
                <div class="colors-section">
                    <h2 class="section-title">Colores Dominantes</h2>
                    
                    <div class="controls">
                        <input type="text" id="colorsUrl" placeholder="URL de imagen" class="styled-input wide-input">
                        <button class="btn btn-start" onclick="analyzeColorsUrl()">üé® Extraer Colores (URL)</button>
                    </div>
                    
                    <div class="controls">
                        <input type="file" id="colorsFile" accept="image/*" class="styled-input">
                        <button class="btn btn-start" onclick="analyzeColorsFile()">üìÅ Extraer Colores (Archivo)</button>
                    </div>
                    
                    <div class="controls">
                        <label style="color: #9ca3af;">N√∫mero m√°ximo de colores:</label>
                        <input type="number" id="maxColors" value="5" min="1" max="10" class="styled-input" style="width: 80px;">
                    </div>
                    
                    <div id="colorsLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Extrayendo colores...</p>
                    </div>
                    
                    <div id="colorsResult" class="color-palette"></div>
                    <div id="colorsImage" class="image-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tabDiv => tabDiv.style.display = 'none');
            document.querySelector('.tab-btn[onclick*="' + tab + '"]').classList.add('active');
            document.getElementById('tab-' + tab).style.display = 'block';
        }

        // Fashion Tagging Functions
        async function analyzeFashionUrl() {
            const url = document.getElementById('fashionUrl').value;
            if (!url) {
                alert('Por favor ingrese una URL de imagen');
                return;
            }
            
            const language = document.getElementById('fashionLanguage').value;
            const detectAll = document.getElementById('detectAll').checked;
            
            document.getElementById('fashionLoading').style.display = 'block';
            document.getElementById('fashionResult').innerHTML = '';
            
            const response = await fetch('/fashion/detect-tags', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url, language, detect_all: detectAll })
            });
            
            document.getElementById('fashionLoading').style.display = 'none';
            const data = await response.json();
            displayFashionResults(data, url);
        }

        async function analyzeFashionFile() {
            const fileInput = document.getElementById('fashionFile');
            if (!fileInput.files.length) {
                alert('Por favor seleccione un archivo de imagen');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('language', document.getElementById('fashionLanguage').value);
            formData.append('detect_all', document.getElementById('detectAll').checked);
            
            document.getElementById('fashionLoading').style.display = 'block';
            document.getElementById('fashionResult').innerHTML = '';
            
            const response = await fetch('/fashion/upload', {
                method: 'POST',
                body: formData
            });
            
            document.getElementById('fashionLoading').style.display = 'none';
            const data = await response.json();
            displayFashionResults(data);
        }

        function displayFashionResults(data, imageUrl) {
            const resultDiv = document.getElementById('fashionResult');
            const imageDiv = document.getElementById('fashionImage');
            
            if (data.error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.error}</div>`;
                return;
            }
            
            if (!data.records || !data.records.length) {
                resultDiv.innerHTML = '<div class="error">No se encontraron resultados</div>';
                return;
            }
            
            const record = data.records[0];
            let html = '<div style="background: rgba(31, 41, 55, 0.5); padding: 20px; border-radius: 15px; margin-top: 20px;">';
            
            if (imageUrl) {
                imageDiv.innerHTML = `<img src="${imageUrl}" style="max-width: 100%; border-radius: 10px; margin-bottom: 20px;">`;
            }
            
            if (record._objects && record._objects.length > 0) {
                html += '<h3 style="color: #a5b4fc; margin-bottom: 15px;">üè∑Ô∏è Objetos Detectados:</h3>';
                
                record._objects.forEach((obj, idx) => {
                    html += `<div style="background: rgba(17, 24, 39, 0.6); padding: 15px; margin-bottom: 15px; border-radius: 10px; border-left: 4px solid #6366f1;">`;
                    html += `<h4 style="color: #c4b5fd;">Objeto ${idx + 1}: ${obj.name} (${(obj.prob * 100).toFixed(1)}%)</h4>`;
                    
                    if (obj._tags_map) {
                        html += '<div style="margin-top: 10px;">';
                        for (const [key, value] of Object.entries(obj._tags_map)) {
                            html += `<span style="background: rgba(99, 102, 241, 0.2); color: #a5b4fc; padding: 6px 12px; margin: 4px; border-radius: 8px; display: inline-block;"><strong>${key}:</strong> ${value}</span>`;
                        }
                        html += '</div>';
                    }
                    
                    if (obj.bound_box) {
                        html += `<p style="color: #9ca3af; margin-top: 10px; font-size: 0.9em;">üìç Posici√≥n: [${obj.bound_box.join(', ')}]</p>`;
                    }
                    
                    html += '</div>';
                });
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }

        // Background Removal Functions
        async function removeBgUrl() {
            const url = document.getElementById('removebgUrl').value;
            if (!url) {
                alert('Por favor ingrese una URL de imagen');
                return;
            }
            
            const model = document.getElementById('removebgModel').value;
            const whiteBg = document.getElementById('whiteBg').checked;
            const binaryMask = document.getElementById('binaryMask').checked;
            
            document.getElementById('removebgLoading').style.display = 'block';
            document.getElementById('removebgResult').innerHTML = '';
            
            const response = await fetch('/removebg', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url, model, white_background: whiteBg, binary_mask: binaryMask })
            });
            
            document.getElementById('removebgLoading').style.display = 'none';
            const data = await response.json();
            displayRemoveBgResults(data);
        }

        async function removeBgFile() {
            const fileInput = document.getElementById('removebgFile');
            if (!fileInput.files.length) {
                alert('Por favor seleccione un archivo de imagen');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('model', document.getElementById('removebgModel').value);
            formData.append('white_background', document.getElementById('whiteBg').checked);
            formData.append('binary_mask', document.getElementById('binaryMask').checked);
            
            document.getElementById('removebgLoading').style.display = 'block';
            document.getElementById('removebgResult').innerHTML = '';
            
            const response = await fetch('/removebg/upload', {
                method: 'POST',
                body: formData
            });
            
            document.getElementById('removebgLoading').style.display = 'none';
            const data = await response.json();
            displayRemoveBgResults(data);
        }

        function displayRemoveBgResults(data) {
            const resultDiv = document.getElementById('removebgResult');
            
            if (data.error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.error}</div>`;
                return;
            }
            
            if (!data.records || !data.records.length) {
                resultDiv.innerHTML = '<div class="error">No se encontraron resultados</div>';
                return;
            }
            
            const record = data.records[0];
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">';
            
            if (record._output_url) {
                html += `
                    <div style="background: rgba(31, 41, 55, 0.5); padding: 15px; border-radius: 10px;">
                        <h4 style="color: #a5b4fc; margin-bottom: 10px;">üñºÔ∏è Fondo Transparente</h4>
                        <img src="${record._output_url}" style="width: 100%; border-radius: 8px; background: repeating-conic-gradient(#808080 0% 25%, transparent 0% 50%) 50% / 20px 20px;">
                        <a href="${record._output_url}" download class="btn btn-start" style="margin-top: 10px; justify-content: center;">‚¨áÔ∏è Descargar</a>
                    </div>
                `;
            }
            
            if (record._output_url_whitebg) {
                html += `
                    <div style="background: rgba(31, 41, 55, 0.5); padding: 15px; border-radius: 10px;">
                        <h4 style="color: #a5b4fc; margin-bottom: 10px;">‚¨ú Fondo Blanco</h4>
                        <img src="${record._output_url_whitebg}" style="width: 100%; border-radius: 8px;">
                        <a href="${record._output_url_whitebg}" download class="btn btn-start" style="margin-top: 10px; justify-content: center;">‚¨áÔ∏è Descargar</a>
                    </div>
                `;
            }
            
            if (record._output_url_mask) {
                html += `
                    <div style="background: rgba(31, 41, 55, 0.5); padding: 15px; border-radius: 10px;">
                        <h4 style="color: #a5b4fc; margin-bottom: 10px;">üé≠ M√°scara Binaria</h4>
                        <img src="${record._output_url_mask}" style="width: 100%; border-radius: 8px;">
                        <a href="${record._output_url_mask}" download class="btn btn-start" style="margin-top: 10px; justify-content: center;">‚¨áÔ∏è Descargar</a>
                    </div>
                `;
            }
            
            html += '</div>';
            html += `<p style="color: #9ca3af; margin-top: 15px; text-align: center; font-size: 0.9em;">‚è±Ô∏è Tiempo de procesamiento: ${data.statistics['processing time'].toFixed(2)}s</p>`;
            
            resultDiv.innerHTML = html;
        }

        // Dominant Colors Functions
        async function analyzeColorsUrl() {
            const url = document.getElementById('colorsUrl').value;
            if (!url) {
                alert('Por favor ingrese una URL de imagen');
                return;
            }
            
            const maxColors = parseInt(document.getElementById('maxColors').value);
            
            document.getElementById('colorsLoading').style.display = 'block';
            document.getElementById('colorsResult').innerHTML = '';
            
            const response = await fetch('/colors/dominant', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url, max_colors: maxColors })
            });
            
            document.getElementById('colorsLoading').style.display = 'none';
            const data = await response.json();
            displayColorsResults(data, url);
        }

        async function analyzeColorsFile() {
            const fileInput = document.getElementById('colorsFile');
            if (!fileInput.files.length) {
                alert('Por favor seleccione un archivo de imagen');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('max_colors', document.getElementById('maxColors').value);
            
            document.getElementById('colorsLoading').style.display = 'block';
            document.getElementById('colorsResult').innerHTML = '';
            
            const response = await fetch('/colors/upload', {
                method: 'POST',
                body: formData
            });
            
            document.getElementById('colorsLoading').style.display = 'none';
            const data = await response.json();
            displayColorsResults(data);
        }

        function displayColorsResults(data, imageUrl) {
            const resultDiv = document.getElementById('colorsResult');
            const imageDiv = document.getElementById('colorsImage');
            
            if (data.error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.error}</div>`;
                return;
            }
            
            if (!data.records || !data.records.length) {
                resultDiv.innerHTML = '<div class="error">No se encontraron resultados</div>';
                return;
            }
            
            const record = data.records[0];
            
            if (imageUrl) {
                imageDiv.innerHTML = `<img src="${imageUrl}" style="max-width: 100%; border-radius: 10px; margin-bottom: 20px;">`;
            }
            
            let html = '<div style="margin-top: 20px;">';
            
            if (record._dominant_colors && record._dominant_colors.length > 0) {
                html += '<h3 style="color: #a5b4fc; margin-bottom: 15px;">üé® Colores Dominantes:</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">';
                
                record._dominant_colors.forEach(color => {
                    const rgb = `rgb(${color.r}, ${color.g}, ${color.b})`;
                    html += `
                        <div style="background: rgba(31, 41, 55, 0.5); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="width: 100%; height: 80px; background: ${rgb}; border-radius: 8px; margin-bottom: 10px; border: 2px solid rgba(255,255,255,0.1);"></div>
                            <p style="color: #e5e7eb; font-weight: 600; margin-bottom: 5px;">${color.name || 'Color'}</p>
                            <p style="color: #9ca3af; font-size: 0.85em;">RGB(${color.r}, ${color.g}, ${color.b})</p>
                            <p style="color: #9ca3af; font-size: 0.85em;">${(color.coverage * 100).toFixed(1)}% cobertura</p>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>
